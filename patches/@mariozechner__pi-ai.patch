diff --git a/dist/providers/google-shared.js b/dist/providers/google-shared.js
--- a/dist/providers/google-shared.js
+++ b/dist/providers/google-shared.js
@@ -63,13 +63,27 @@ export function requiresToolCallId(modelId) {
 export function convertMessages(model, context) {
     const contents = [];
     const transformedMessages = transformMessages(context.messages, model);
+    /**
+     * Helper to add content while merging consecutive messages of the same role.
+     * Gemini/Cloud Code Assist requires strict role alternation (user/model/user/model).
+     * Consecutive messages of the same role cause "function call turn" errors.
+     */
+    function addContent(role, parts) {
+        if (parts.length === 0)
+            return;
+        const lastContent = contents[contents.length - 1];
+        if (lastContent?.role === role) {
+            // Merge into existing message of same role
+            lastContent.parts.push(...parts);
+        }
+        else {
+            contents.push({ role, parts });
+        }
+    }
     for (const msg of transformedMessages) {
         if (msg.role === "user") {
             if (typeof msg.content === "string") {
-                contents.push({
-                    role: "user",
-                    parts: [{ text: sanitizeSurrogates(msg.content) }],
-                });
+                addContent("user", [{ text: sanitizeSurrogates(msg.content) }]);
             }
             else {
                 const parts = msg.content.map((item) => {
@@ -88,10 +102,7 @@ export function convertMessages(model, context) {
                 const filteredParts = !model.input.includes("image") ? parts.filter((p) => p.text !== undefined) : parts;
                 if (filteredParts.length === 0)
                     continue;
-                contents.push({
-                    role: "user",
-                    parts: filteredParts,
-                });
+                addContent("user", filteredParts);
             }
         }
         else if (msg.role === "assistant") {
@@ -146,10 +157,7 @@ export function convertMessages(model, context) {
             }
             if (parts.length === 0)
                 continue;
-            contents.push({
-                role: "model",
-                parts,
-            });
+            addContent("model", parts);
         }
         else if (msg.role === "toolResult") {
             // Extract text and image content
@@ -183,23 +191,12 @@ export function convertMessages(model, context) {
                 },
             };
             // Cloud Code Assist API requires all function responses to be in a single user turn.
-            // Check if the last content is already a user turn with function responses and merge.
-            const lastContent = contents[contents.length - 1];
-            if (lastContent?.role === "user" && lastContent.parts?.some((p) => p.functionResponse)) {
-                lastContent.parts.push(functionResponsePart);
-            }
-            else {
-                contents.push({
-                    role: "user",
-                    parts: [functionResponsePart],
-                });
-            }
+            // Use addContent for proper role alternation handling - it will merge consecutive user messages.
+            addContent("user", [functionResponsePart]);
             // For older models, add images in a separate user message
+            // Note: This may create consecutive user messages, but addContent will merge them
             if (hasImages && !supportsMultimodalFunctionResponse) {
-                contents.push({
-                    role: "user",
-                    parts: [{ text: "Tool result image:" }, ...imageParts],
-                });
+                addContent("user", [{ text: "Tool result image:" }, ...imageParts]);
             }
         }
     }
